<div class="space-y-6 animate-in fade-in duration-500">
    <!-- Profile Header Card -->
    <div
        class="bg-white dark:bg-space-light rounded-2xl shadow-lg border border-gray-200 dark:border-space-secondary overflow-hidden">
        <!-- Cover Image -->
        <div class="h-48 bg-gradient-to-r from-blue-900 via-indigo-900 to-slate-900 relative">
            <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10">
            </div>
            <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
        </div>

        <div class="px-8 pb-8">
            <div class="flex flex-col md:flex-row items-start gap-6 -mt-16 relative z-10">
                <!-- Avatar -->
                <div class="relative group">
                    <div
                        class="w-32 h-32 rounded-full border-4 border-white dark:border-space-light bg-space-dark overflow-hidden shadow-2xl relative z-10">
                        @if (authService.currentUserValue?.profilePhoto) {
                        <img [src]="authService.currentUserValue?.profilePhoto"
                            [alt]="authService.currentUserValue?.name" class="w-full h-full object-cover">
                        } @else {
                        <div
                            class="w-full h-full flex items-center justify-center bg-gradient-to-br from-sky-500 to-blue-700 text-white text-4xl font-bold">
                            {{ (authService.currentUserValue?.name?.charAt(0) || 'U').toUpperCase() }}
                        </div>
                        }
                    </div>
                    <div class="absolute -bottom-2 -right-2 bg-green-500 w-6 h-6 rounded-full border-4 border-white dark:border-space-light z-20"
                        title="Online"></div>
                </div>

                <!-- User Info -->
                <div class="flex-1 pt-16 md:pt-16 pb-2 min-w-0">
                    <div class="flex flex-col md:flex-row md:items-center gap-4 mb-2">
                        <h1 class="text-3xl font-bold text-gray-900 dark:text-white truncate">
                            {{ authService.currentUserValue?.name || 'User' }}
                        </h1>
                        <div class="flex items-center gap-2">
                            <span
                                class="px-2 py-0.5 rounded text-xs font-mono bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 border border-gray-200 dark:border-gray-700">
                                [0x9]
                            </span>
                            <span
                                class="px-2 py-0.5 rounded text-xs font-bold bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-800">
                                {{ authService.currentUserValue?.role || 'Student' }}
                            </span>
                            <span
                                class="flex items-center gap-1 px-2 py-0.5 rounded text-xs text-gray-600 dark:text-gray-400">
                                <ng-icon name="lucideMapPin" size="12"></ng-icon> EG
                            </span>
                        </div>
                    </div>

                    <p class="text-gray-600 dark:text-gray-400 mb-4 max-w-2xl whitespace-pre-wrap">
                        {{ authService.currentUserValue?.bio || "Cybersecurity enthusiast and learner. Passionate about
                        ethical hacking and network defense." }}
                    </p>

                    <div class="flex flex-wrap items-center gap-4 text-sm text-gray-600 dark:text-gray-400 mb-6">
                        <span class="flex items-center gap-1 hover:text-sky-500 cursor-pointer transition-colors">
                            <ng-icon name="lucideFlame" size="16" class="text-orange-500"></ng-icon>
                            <span class="font-bold text-gray-900 dark:text-white">0</span> Following
                        </span>
                        <span class="flex items-center gap-1 hover:text-sky-500 cursor-pointer transition-colors">
                            <div
                                class="w-4 h-4 rounded-full bg-sky-500 flex items-center justify-center text-[10px] text-white font-bold">
                                1</div>
                            <span class="font-bold text-gray-900 dark:text-white">1</span> Followers
                        </span>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-wrap gap-3">
                        <button
                            class="px-4 py-2 bg-transparent border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:border-gray-400 dark:hover:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors text-sm font-medium">
                            Add Socials
                        </button>
                        <a routerLink="/manage-account"
                            class="px-4 py-2 bg-transparent border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:border-gray-400 dark:hover:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors text-sm font-medium flex items-center gap-2">
                            <ng-icon name="lucideSettings" size="16"></ng-icon> Edit Profile
                        </a>
                        <button
                            class="px-4 py-2 bg-transparent border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:border-gray-400 dark:hover:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors text-sm font-medium flex items-center gap-2">
                            <ng-icon name="lucideShare2" size="16"></ng-icon> Share badges
                        </button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="w-full md:w-auto flex flex-col sm:flex-row md:flex-col gap-4 min-w-[240px]">
                    <!-- Rank Card -->
                    <div
                        class="bg-gray-50 dark:bg-space-dark/50 rounded-xl p-4 border border-gray-200 dark:border-space-secondary/50">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Rank</span>
                            <span class="text-xs font-bold text-sky-500">Global</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <ng-icon name="lucideTrophy" class="text-yellow-500 w-8 h-8"></ng-icon>
                            <span class="text-2xl font-bold text-gray-900 dark:text-white">#{{ stats?.rank || 0
                                }}</span>
                        </div>
                    </div>

                    <!-- Badges & Streak Row -->
                    <div class="flex gap-4">
                        <div
                            class="flex-1 bg-gray-50 dark:bg-space-dark/50 rounded-xl p-4 border border-gray-200 dark:border-space-secondary/50">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Badges</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <ng-icon name="lucideAward" class="text-purple-500 w-6 h-6"></ng-icon>
                                <span class="text-2xl font-bold text-gray-900 dark:text-white">{{ stats?.badges?.length
                                    || 0 }}</span>
                            </div>
                        </div>
                        <div
                            class="flex-1 bg-gray-50 dark:bg-space-dark/50 rounded-xl p-4 border border-gray-200 dark:border-space-secondary/50">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Streak</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <ng-icon name="lucideFlame" class="text-orange-500 w-6 h-6"></ng-icon>
                                <span class="text-2xl font-bold text-gray-900 dark:text-white">{{ stats?.streak || 0
                                    }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Points Card -->
                    <div
                        class="bg-gray-50 dark:bg-space-dark/50 rounded-xl p-4 border border-gray-200 dark:border-space-secondary/50">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Points (XP)</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="bg-blue-500 w-2 h-8 rounded-sm"></div>
                            <div class="bg-white w-2 h-8 rounded-sm opacity-20"></div>
                            <span class="text-2xl font-bold text-gray-900 dark:text-white">{{ stats?.points || 0
                                }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div
        class="flex items-center gap-6 border-b border-gray-200 dark:border-gray-700 overflow-x-auto pb-1 scrollbar-hide">
        <button (click)="activeTab = 'labs'"
            class="flex items-center gap-2 pb-3 border-b-2 font-medium whitespace-nowrap transition-colors"
            [ngClass]="activeTab === 'labs'
                    ? 'border-sky-500 text-sky-600 dark:text-white'
                    : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200'">
            <ng-icon name="lucideTarget" size="18"></ng-icon> Completed labs ({{ completedLabs.length }})
        </button>
        <button (click)="activeTab = 'badges'"
            class="flex items-center gap-2 pb-3 border-b-2 font-medium whitespace-nowrap transition-colors"
            [ngClass]="activeTab === 'badges'
                    ? 'border-sky-500 text-sky-600 dark:text-white'
                    : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200'">
            <ng-icon name="lucideAward" size="18"></ng-icon> Badges ({{ stats?.badges?.length || 0 }})
        </button>
    </div>

    <!-- Content Area -->
    @if (activeTab === 'labs') {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        @if (completedLabs.length > 0) {
        @for (entry of completedLabs; track entry.resultId) {
        <div
            class="bg-white dark:bg-space-light rounded-xl p-5 border border-gray-200 dark:border-space-secondary hover:border-sky-500 dark:hover:border-sky-500 transition-colors group cursor-pointer flex flex-col h-full">
            <div class="flex items-start justify-between mb-4">
                <div
                    class="p-3 bg-gray-100 dark:bg-space-dark rounded-lg group-hover:bg-sky-50 dark:group-hover:bg-sky-900/20 transition-colors">
                    <ng-icon name="lucideGraduationCap" class="text-sky-600 dark:text-sky-400" size="24"></ng-icon>
                </div>
                <span class="text-[10px] text-gray-400">{{ entry.completionTime | date:'shortDate' }}</span>
            </div>

            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2 line-clamp-1">{{ entry.lab.title }}</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-4 line-clamp-2 flex-1">{{ entry.lab.description }}</p>

            <div class="mt-auto flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500"></span>
                    <span class="text-xs font-medium text-green-600 dark:text-green-400 uppercase">{{
                        entry.lab.difficulty }}</span>
                </div>
                <span class="text-xs font-bold text-yellow-600">+{{ entry.lab.points }} XP</span>
            </div>
        </div>
        }
        } @else {
        <div class="col-span-full py-12 text-center text-gray-500 dark:text-gray-400">
            You haven't completed any labs yet.
        </div>
        }
    </div>
    } @else {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        @if (stats?.badges && stats!.badges.length > 0) {
        @for (badge of stats!.badges; track badge.badgeId) {
        <div
            class="bg-white dark:bg-space-light rounded-xl p-5 border border-gray-200 dark:border-space-secondary hover:border-purple-500 dark:hover:border-purple-500 transition-colors group cursor-pointer flex flex-col items-center text-center">
            <div class="p-4 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full mb-4 shadow-lg">
                <ng-icon name="lucideAward" class="text-white" size="32"></ng-icon>
            </div>
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">{{ badge.name }}</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">{{ badge.description }}</p>
            <span
                class="text-xs font-bold text-purple-600 dark:text-purple-400 bg-purple-100 dark:bg-purple-900/30 px-3 py-1 rounded-full">
                {{ badge.pointsRequired }} Points Required
            </span>
        </div>
        }
        } @else {
        <div class="col-span-full py-12 text-center text-gray-500 dark:text-gray-400">
            You haven't earned any badges yet. Complete labs to earn points and unlock badges!
        </div>
        }
    </div>
    }
</div>