<div class="space-y-6">
    <div class="flex flex-col items-center justify-center py-6 animate-fade-in">
        <h1
            class="text-4xl font-display font-bold text-transparent bg-clip-text bg-gradient-to-r from-sky-600 to-electric-purple dark:from-sky-blue dark:to-electric-purple mb-2">
            Training Labs</h1>
        <p class="text-gray-500 dark:text-gray-400 max-w-2xl text-center">Interactive environments to practice and
            refine your cybersecurity skills</p>
    </div>

    <!-- Filters -->
    <div
        class="flex flex-col md:flex-row items-center justify-between gap-4 bg-white/50 dark:bg-space-secondary/20 p-4 rounded-xl backdrop-blur-sm border border-gray-100 dark:border-space-secondary/40 shadow-sm">
        <div class="relative w-full md:w-96">
            <input type="text" placeholder="Search labs..." [(ngModel)]="searchQuery" (ngModelChange)="filterLabs()"
                class="w-full pl-10 pr-4 py-2 bg-white dark:bg-space-dark border border-gray-200 dark:border-space-secondary/50 rounded-lg text-sm text-gray-700 dark:text-gray-300 focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all">
            <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                <ng-icon name="lucideSearch" size="18"></ng-icon>
            </div>
        </div>

        <div class="flex flex-wrap items-center gap-2">
            <select [(ngModel)]="selectedDifficulty" (ngModelChange)="filterLabs()"
                class="px-4 py-2 bg-white dark:bg-space-dark border border-gray-200 dark:border-space-secondary/50 rounded-lg text-sm text-gray-700 dark:text-gray-300 focus:ring-2 focus:ring-sky-500">
                <option [ngValue]="null">All Difficulties</option>
                <option *ngFor="let diff of difficulties" [value]="diff">{{ diff }}</option>
            </select>

            <select [(ngModel)]="selectedCategory" (ngModelChange)="filterLabs()"
                class="px-4 py-2 bg-white dark:bg-space-dark border border-gray-200 dark:border-space-secondary/50 rounded-lg text-sm text-gray-700 dark:text-gray-300 focus:ring-2 focus:ring-sky-500">
                <option [ngValue]="null">All Categories</option>
                <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
            </select>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="flex flex-col items-center justify-center py-12 text-gray-400">
        <div class="w-12 h-12 border-4 border-sky-500/30 border-t-sky-500 rounded-full animate-spin mb-4"></div>
        <span class="animate-pulse">Loading mission simulations...</span>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && filteredLabs.length === 0"
        class="text-center py-12 text-slate-400 bg-white/50 dark:bg-space-secondary/20 rounded-xl border border-dashed border-gray-300 dark:border-gray-700">
        <p>No labs found matching your criteria.</p>
        <button (click)="searchQuery=''; selectedDifficulty=null; selectedCategory=null; filterLabs()"
            class="mt-4 text-sky-500 hover:text-sky-400 hover:underline">
            Reset Filters
        </button>
    </div>

    <!-- Labs Grid -->
    <div *ngIf="!loading && filteredLabs.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div *ngFor="let lab of filteredLabs"
            class="bg-white dark:bg-slate-800 rounded-xl shadow-lg hover:shadow-xl dark:shadow-none hover:shadow-sky-500/10 overflow-hidden transition-all duration-300 border group"
            [ngClass]="isCompleted(lab.labId) ? 'border-emerald-500/40' : 'border-gray-200 dark:border-slate-700 hover:border-sky-300 dark:hover:border-slate-600'">

            <!-- Card Header -->
            <div class="p-5 border-b border-gray-100 dark:border-slate-700 bg-gray-50/50 dark:bg-slate-800/50">
                <div class="flex items-start justify-between">
                    <div class="flex items-center gap-3">
                        <div
                            class="p-2 bg-sky-50 dark:bg-slate-700 rounded-lg group-hover:bg-sky-100 dark:group-hover:bg-slate-600 transition-colors">
                            <ng-icon name="lucideGraduationCap" class="text-sky-600 dark:text-slate-300"
                                size="22"></ng-icon>
                        </div>
                        <div>
                            <h3
                                class="text-lg font-bold text-gray-900 dark:text-white leading-tight line-clamp-1 group-hover:text-sky-600 dark:group-hover:text-sky-400 transition-colors">
                                {{ lab.title }}
                            </h3>
                        </div>
                    </div>
                    <div *ngIf="isCompleted(lab.labId)"
                        class="flex items-center gap-1 px-2 py-1 bg-emerald-600/20 border border-emerald-500/30 rounded-full">
                        <ng-icon name="lucideCircleCheck" size="14"
                            class="text-emerald-600 dark:text-emerald-400"></ng-icon>
                        <span class="text-xs font-medium text-emerald-600 dark:text-emerald-400">Solved</span>
                    </div>
                </div>
            </div>

            <!-- Card Content -->
            <div class="p-5">
                <p class="text-sm text-gray-600 dark:text-slate-400 mb-4 line-clamp-2 leading-relaxed h-10">
                    {{ lab.description }}
                </p>

                <!-- Tags -->
                <div class="flex flex-wrap items-center gap-2 mb-5">
                    <span *ngIf="lab.difficulty" class="px-2.5 py-1 text-xs font-medium rounded-full"
                        [ngClass]="getDifficultyColor(lab.difficulty)">
                        {{ lab.difficulty }}
                    </span>
                    <span *ngIf="lab.category"
                        class="px-2.5 py-1 bg-blue-600/20 text-blue-600 dark:text-blue-400 border border-blue-500/30 text-xs font-medium rounded-full">
                        {{ lab.category }}
                    </span>
                    <span
                        class="px-2.5 py-1 bg-lime-600/20 text-lime-600 dark:text-lime-400 border border-lime-500/30 text-xs font-semibold rounded-full flex items-center gap-1">
                        {{ lab.points }} XP
                    </span>
                </div>

                <!-- Access Lab Button -->
                <a [routerLink]="['/labs', lab.labId]"
                    class="w-full flex items-center justify-center gap-2 bg-sky-600 hover:bg-sky-700 text-white font-semibold py-2.5 px-4 rounded-lg transition-all duration-200 transform group-hover:translate-y-[-2px] shadow-md hover:shadow-lg dark:shadow-glow-blue">
                    <span>Access Lab</span>
                    <ng-icon name="lucideArrowRight" size="18"></ng-icon>
                </a>
            </div>
        </div>
    </div>
</div>